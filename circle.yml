machine:
  services:
      - docker
  java:
    version: oraclejdk8

checkout:
  post:
    - git clone git@github.com:Civil-Service-Human-Resources/ci-support.git

test:
  override:
    - ./gradlew build
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

deployment:
  docker:
    branch: master
    commands:
      - ci-support/docker/credentials.sh
      - ci-support/docker/pull.sh
      - ci-support/docker/build.sh
      - ci-support/docker/push.sh
